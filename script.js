let slider = document.getElementById("myRange");
let output = document.getElementById("demo");
// Display the default slider value
output.innerHTML = slider.value;

// Update the current slider value (each time you drag the slider handle)
let q2 = slider.value;
let q2gap = {
  1.0: -20.15801039,
  1.1: -20.3231402,
  1.2: -20.48824944,
  1.3: -20.6533772,
  1.4: -20.81851238,
  1.5: -20.98363723,
  1.6: -21.14875474,
  1.7: -21.31389811,
  1.8: -21.47900747,
  1.9: -21.64415461,
  2.0: -21.80927256,
  2.1: -21.97440596,
  2.2: -22.13951521,
  2.3: -22.30464999,
  2.4: -22.46978382,
  2.5: -22.63489423,
  2.6: -22.80002155,
  2.7: -22.96516889,
  2.8: -23.13028568,
  2.9: -23.29542354,
  3.0: -23.46052765,
  3.1: -23.62567278,
  3.2: -23.79079258,
  3.3: -23.95591415,
  3.4: -24.12104466,
  3.5: -24.28617083,
  3.6: -24.45127335,
  3.7: -24.61641836,
  3.8: -24.78155327,
  3.9: -24.94667032,
  4.0: -25.1117917,
};

function graph(slider_value) {
  let recessions = [
    [1969.75, 1970.75],
    [1973.75, 1975.0],
    [1980.0, 1980.5],
    [1981.5, 1982.75],
    [1990.5, 1991.0],
    [2001.0, 2001.75],
    [2007.75, 2009.25],
  ];
  let recession_shapes = [];
  for (var i = 0; i < recessions.length; i++) {
    recession_shapes.push({
      type: "rect",
      xref: "x",
      yref: "paper",
      x0: recessions[i][0],
      y0: 0,
      x1: recessions[i][1],
      y1: 1,
      fillcolor: "#cccccc",
      opacity: 1,
      line: {
        width: 0,
      },
      layer: "below",
    });
  }
  let trace1 = {
    x: [
      1967.25,
      1967.5,
      1967.75,
      1968.0,
      1968.25,
      1968.5,
      1968.75,
      1969.0,
      1969.25,
      1969.5,
      1969.75,
      1970.0,
      1970.25,
      1970.5,
      1970.75,
      1971.0,
      1971.25,
      1971.5,
      1971.75,
      1972.0,
      1972.25,
      1972.5,
      1972.75,
      1973.0,
      1973.25,
      1973.5,
      1973.75,
      1974.0,
      1974.25,
      1974.5,
      1974.75,
      1975.0,
      1975.25,
      1975.5,
      1975.75,
      1976.0,
      1976.25,
      1976.5,
      1976.75,
      1977.0,
      1977.25,
      1977.5,
      1977.75,
      1978.0,
      1978.25,
      1978.5,
      1978.75,
      1979.0,
      1979.25,
      1979.5,
      1979.75,
      1980.0,
      1980.25,
      1980.5,
      1980.75,
      1981.0,
      1981.25,
      1981.5,
      1981.75,
      1982.0,
      1982.25,
      1982.5,
      1982.75,
      1983.0,
      1983.25,
      1983.5,
      1983.75,
      1984.0,
      1984.25,
      1984.5,
      1984.75,
      1985.0,
      1985.25,
      1985.5,
      1985.75,
      1986.0,
      1986.25,
      1986.5,
      1986.75,
      1987.0,
      1987.25,
      1987.5,
      1987.75,
      1988.0,
      1988.25,
      1988.5,
      1988.75,
      1989.0,
      1989.25,
      1989.5,
      1989.75,
      1990.0,
      1990.25,
      1990.5,
      1990.75,
      1991.0,
      1991.25,
      1991.5,
      1991.75,
      1992.0,
      1992.25,
      1992.5,
      1992.75,
      1993.0,
      1993.25,
      1993.5,
      1993.75,
      1994.0,
      1994.25,
      1994.5,
      1994.75,
      1995.0,
      1995.25,
      1995.5,
      1995.75,
      1996.0,
      1996.25,
      1996.5,
      1996.75,
      1997.0,
      1997.25,
      1997.5,
      1997.75,
      1998.0,
      1998.25,
      1998.5,
      1998.75,
      1999.0,
      1999.25,
      1999.5,
      1999.75,
      2000.0,
      2000.25,
      2000.5,
      2000.75,
      2001.0,
      2001.25,
      2001.5,
      2001.75,
      2002.0,
      2002.25,
      2002.5,
      2002.75,
      2003.0,
      2003.25,
      2003.5,
      2003.75,
      2004.0,
      2004.25,
      2004.5,
      2004.75,
      2005.0,
      2005.25,
      2005.5,
      2005.75,
      2006.0,
      2006.25,
      2006.5,
      2006.75,
      2007.0,
      2007.25,
      2007.5,
      2007.75,
      2008.0,
      2008.25,
      2008.5,
      2008.75,
      2009.0,
      2009.25,
      2009.5,
      2009.75,
      2010.0,
      2010.25,
      2010.5,
      2010.75,
      2011.0,
      2011.25,
      2011.5,
      2011.75,
      2012.0,
      2012.25,
      2012.5,
      2012.75,
      2013.0,
      2013.25,
      2013.5,
      2013.75,
      2014.0,
      2014.25,
      2014.5,
      2014.75,
      2015.0,
      2015.25,
      2015.5,
      2015.75,
      2016.0,
      2016.25,
      2016.5,
      2016.75,
      2017.0,
      2017.25,
      2017.5,
      2017.75,
      2018.0,
      2018.25,
      2018.5,
      2018.75,
      2019.0,
      2019.25,
      2019.5,
      2019.75,
      2020.0,
    ],
    y: [0.02517, 0.03077, 0.03135, 0.03453, 0.03846, 0.03965, 0.04013, 0.03944, 0.04098, 0.04294, 0.04455, 0.03352, 0.02511, 0.0218, 0.00952, 0.01529, 0.01419, 0.01005, 0.01035, 0.00951, 0.01164, 0.0113, 0.01514, 0.02821, 0.03134, 0.03476, 0.03354, 0.02672, 0.02738, 0.0216, 0.00453, -0.02704, -0.03639, -0.02916, -0.02218, -0.01634, -0.01636, -0.02292, -0.02497, -0.02553, -0.01831, -0.01418, -0.00791, -0.00589, 0.00378, 0.00592, 0.00925, 0.00795, 0.01025, 0.01085, 0.00947, 0.00668, -0.01972, -0.03109, -0.01254, -0.00585, -0.01182, -0.01581, -0.02868, -0.03845, -0.04583, -0.05818, -0.06732, -0.05638, -0.05809, -0.04939, -0.03346, -0.02638, -0.02181, -0.02499, -0.02725, -0.02382, -0.02303, -0.02197, -0.01893, -0.01798, -0.02045, -0.02015, -0.01415, -0.0081, -0.00362, -0.00078, 0.00558, 0.00178, 0.00515, 0.0035, 0.00788, 0.00934, 0.00783, 0.00418, 0.00159, 0.00257, 0.00296, 0.00356, -0.00019, -0.01547, -0.01898, -0.01537, -0.01315, -0.01512, -0.01849, -0.0176, -0.01312, -0.00798, -0.00612, -0.00107, -0.00266, -0.00879, -0.00469, -0.00131, 0.00143, 0.00331, -0.00165, -0.00349, -0.00203, -0.0033, -0.00027, 0.00236, -0.00057, -0.00031, 0.00127, -0.00062, 0.00282, 0.00188, 0.00358, 0.00519, 0.00689, 0.00747, 0.00753, 0.00993, 0.01133, 0.0097, 0.01424, 0.01097, 0.01, 0.00811, 0.00375, 0.0011, -0.0081, -0.01016, -0.01185, -0.00522, -0.00523, -0.00257, -0.01186, -0.01028, -0.00429, -0.00525, -2e-05, 0.00099, 0.00286, 0.00553, 0.00834, 0.01308, 0.01263, 0.01722, 0.01993, 0.01864, 0.01504, 0.01586, 0.01865, 0.01858, 0.01888, 0.01893, 0.02139, 0.01017, -0.0073, -0.03286, -0.04862, -0.04918, -0.04418, -0.04355, -0.03599, -0.03251, -0.03013, -0.02477, -0.02596, -0.01904, -0.01421, -0.01258, -0.01345, -0.01254, -0.01352, -0.00912, -0.00828, -0.00285, 0.001, 0.00129, 0.00722, 0.01027, 0.01084, 0.01176, 0.01358, 0.01706, 0.01703, 0.01829, 0.01758, 0.02066, 0.02079, 0.02227, 0.02356, 0.02551, 0.02509, 0.02647, 0.02877, 0.03138, 0.03113, 0.03347, 0.03315, 0.03536, 0.03313, -0.067,],
    type: "scatter",
    hoverinfo: "skip",
  };
  let trace2 = {
    x: [2020, 2020.25],
    y: [-0.067, q2gap[slider_value]/100],
    type: "scatter",
    hoverinfo: "skip",
  };
  let layout = {
    shapes: recession_shapes,
    xaxis: { showgrid: false, mirror: false, ticks: "outside", showline: true,fixedrange: true },
    yaxis: { showgrid: false, range: [-0.3, 0.05],tickformat: '%',fixedrange: true },
    margin: { l: 100, r: 20, t: 20, b: 20 },
    showlegend: false,
    annotations: 
       [{
            x:2020.25,
            y:q2gap[slider_value]/100,
            showarrow:true,
            text:"2020 Q2",
            arrowhead:0,
            ax:40,
            ay:0,
            arrowcolor:"#00000000",
       }]
  };

  Plotly.newPlot("graph", [trace1, trace2], layout);
}

function table(slider_value) {
  let values = [
    ["Salaries", "Office", "Merchandise", "Legal", "<b>TOTAL</b>"],
    [slider_value, 20000, 80000, 2000, 12120000],
    [1300000, 20000, 70000, 2000, 130902000],
    [1300000, 20000, 120000, 2000, 131222000],
    [1400000, 20000, 90000, 2000, 14102000],
  ];

  let data = [
    {
      type: "table",
      header: {
        values: [
          ["<b>EXPENSES</b>"],
          ["<b>Q1</b>"],
          ["<b>Q2</b>"],
          ["<b>Q3</b>"],
          ["<b>Q4</b>"],
        ],
        align: "center",
        line: { width: 1, color: "black" },
        fill: { color: "grey" },
        font: { family: "Arial", size: 12, color: "white" },
      },
      cells: {
        values: values,
        align: "center",
        line: { color: "black", width: 1 },
        font: { family: "Arial", size: 11, color: ["black"] },
      },
    },
  ];

  Plotly.newPlot("table", data);
}

// init
graph(q2);
table(0);

// update
slider.oninput = function () {
  output.innerHTML = this.value;
  graph(this.value);
  table(this.value);
};
